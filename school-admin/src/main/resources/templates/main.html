<!DOCTYPE html>
<html  lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--360浏览器优先以webkit内核解析-->
    <title>介绍</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <link href="../static/css/font-awesome.min.css" th:href="@{/css/font-awesome.min.css}" rel="stylesheet"/>
    <link href="../static/css/main/animate.min.css" th:href="@{/css/main/animate.min.css}" rel="stylesheet"/>
    <link href="../static/css/main/style.min862f.css" th:href="@{/css/main/style.min862f.css}" rel="stylesheet"/>
</head>

<body class="gray-bg">
    <div class="wrapper wrapper-content">
        <p>管理人员</p>
        <div class="row">
            <div class="col-sm-6">
            	<div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>在线人数</h5>
                    </div>
                    <div class="ibox-content">
               			 <span id = "onlinenum"></span>人
                    </div>
	             </div>
            </div>
            <div class="col-sm-6">
	            <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>审计统计</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="echarts" id="echarts-pie-chart"></div>
                    </div>
	             </div>
            </div>
        </div>
    </div>
    <script th:src="@{/js/jquery.min.js}"></script>
    <script th:src="@{/js/bootstrap.min.js}"></script>
    <script th:src="@{/ajax/libs/layer/layer.min.js}"></script>
    <th:block th:include="include :: echarts-js" />
    
    <script th:inline="javascript">
    	
    
    
    	
    
    	var datas = [[${@dict.getType('sys_oper_type')}]];
    	//console.log(datas)
    
    	var str= []
    	for(var i = 0; i < datas.length; i++) {
   			 //do something
    		var obj = datas[i]
    		str.push(obj.dictLabel)
		};
    	
    	$(function(){
    		$.ajax({
        		url: "/system/userOnlinenum",
        		type: 'GET',
        		success: function(result) {
        			//console.log(result)
        			$("#onlinenum").text(result.data)
        		}
        	});
    		var pieChart = echarts.init(document.getElementById("echarts-pie-chart"));
    		 $.ajax({
 	            type: "GET",
 	            url: "/system/OperLogbusinesstype",
 	            success: function(result) {
 	            	//console.log(result)
 	            	var redata = result.data
 	            	var redatas = [];
 	            	for(var ij = 0; ij < redata.length; ij++) {
 	            		var obl = redata[ij]
 	            		for(var i = 0; i < datas.length; i++) {
 	            			if(obl.name ==  datas[i].dictValue){
 	            				obl.name = datas[i].dictLabel
 	            			}
 	            		}
 	            			redatas.push(obl)
 	            	}
		 	        var pieoption = {
		 	            title : {
		 	                text: '操作类型',
		 	                subtext: '数据来源内部登陆系统',
		 	                x:'center'
		 	            },
		 	            tooltip : {
		 	                trigger: 'item',
		 	                formatter: "{a} <br/>{b} : {c} ({d}%)"
		 	            },
		 	            legend: {
		 	                orient : 'vertical',
		 	                x : 'left',
		 	                //data:['直接访问','邮件营销','联盟广告','视频广告','搜索引擎']
		 	                data:str
		 	            },
		 	            calculable : true,
		 	            series : [
		 	                {
		 	                    name:'操作类型',
		 	                    type:'pie',
		 	                    radius : '60%',
		 	                    center: ['50%', '65%'],
		 	                    data:redatas
		 	                    	/* [
		 	                        {value:335, name:'直接访问'},
		 	                        {value:310, name:'邮件营销'},
		 	                        {value:234, name:'联盟广告'},
		 	                        {value:135, name:'视频广告'},
		 	                        {value:1548, name:'搜索引擎'}
		 	                    ] */
		 	                }
		 	            ]
		 	        };
		 	        pieChart.setOption(pieoption);
		 	        $(window).resize(pieChart.resize);
 	            },
 	            error: function(error) {
 	            }
 	        });
    		
    		
    		
    		
    		
    		
    	})
    	
    
    </script>
</body>
</html>
